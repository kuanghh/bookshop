<!DOCTYPE html>
<html>
<head>		
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>图书商城</title>
	<meta name="keywords" content="catalog, responsive, bootstrap, free template, fluid layout, templatemo, html5 css3" />
	<meta name="description" content="Catalog theme is free responsive design based on Bootstrap framework." />
	
	<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">

	<link href="templatemo_style.css" rel="stylesheet" type="text/css">
	<!--
	<link href="http://netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet" type="text/css">
	<link href="http://getbootstrap.com/examples/offcanvas/offcanvas.css" rel="stylesheet">
	-->
	</head>
	<body>
		<header>
			<div class="container logo">
				<div class="row">
					<div class="col-md-12"><a href="#"  target="_parent"><img src="images/logo.png" alt="templatemo 379 catalog"></a></div>
					<span style="padding-left: 900px"><a href="../login.html">登录</a>&nbsp;&nbsp;</span>
					<span><a href="javascript:void(0)" onclick="exit('user')">退出</a></span>
				</div>
			</div>
			<nav class="navbar navbar-default" role="navigation"> 
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>					
				</div>

				<div class="collapse navbar-collapse navbar-ex1-collapse">
					<ul class="nav navbar-nav">
						<li class="active"><a href="index.html">首页</a></li>
                        <li><a href="cart.html">我的购物车</a></li>
						<li><a href="myInfo.html">我的账号</a></li>
						<li><a href="contact.html">联系我们</a></li>
						<li><a href="myOrders.html">我的订单</a></li>
					</ul>
					<form class="navbar-form navbar-right" role="search">
						<div class="form-group">
							<input id="searchKey" type="text" class="form-control" placeholder="Search">
						</div>
						<button id="search" type="button" class="btn btn-default">查询商品</button>
					</form>					
				</div><!-- /.navbar-collapse -->
			</nav>
		</header>
		<div class="container" id="home">
			<div class="row row-offcanvas row-offcanvas-left">
				<div class="col col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">	
                			
					<div class="sidebar-nav">
                    
						<h4>图书分类</h4>
						<ul id="categoryUl" class="sidebar_menu">
                        	<li><a href="#" target="_blank">分类1</a></li>
							<li><a href="#"  target="_blank">分类1</a></li>
                            <li><a href="#"  target="_blank">分类1</a></li>
							<li><a href="#"  target="_blank">分类1</a></li>
                            <li><a href="#"  target="_blank">分类1</a></li>
						</ul>
                        
						<hr>
                        
						<h4>关于我们</h4>
						北国风光，千里冰封，万里雪飘。
						望长城内外，惟余莽莽；大河上下，顿失滔滔。
						山舞银蛇，原驰蜡象，欲与天公试比高。
						须晴日，看红装素裹，分外妖娆。
						江山如此多娇，引无数英雄竞折腰。
						惜秦皇汉武，略输文采；唐宗宋祖，稍逊风骚。
						一代天骄，成吉思汗，只识弯弓射大雕。
						俱往矣，数风流人物，还看今朝。
						<div class="cleaner h10"></div>
						
                        
					</div>
                    
				</div> <!-- col sidebar -->
                
				<div class="col col-xs-12 col-sm-9">
					<p class="pull-left visible-xs">
						<button type="button" class="btn btn-primary btn-xs" data-toggle="offcanvas">Toggle nav</button>
					</p>
                    
                    <section class="row" id="website_templates">				
						<div class="row">
							<div class="col-xs-12 col-md-12">
								<h3>最新商品</h3>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-12 col-md-12">
								<div id="item_container" class="item_container">
									<!--<div class="item">-->
										<!--<a href="item_preview.html" class="thumbnail">-->
											<!--<img src="images/templatemo_377_blue_tech.jpg" alt="377 blue tech">-->
											<!--<p>商品1</p>-->
										<!--</a>-->
									<!--</div>		          -->
									<!--<div class="item">-->
										<!--<a href="item_preview.html" class="thumbnail">-->
											<!--<img src="images/templatemo_376_secured.jpg" alt="376 secured">-->
											<!--<p>商品1</p>-->
										<!--</a>-->
									<!--</div>-->
									<!--<div class="item">-->
										<!--<a href="item_preview.html" class="thumbnail">-->
											<!--<img src="images/templatemo_374_responsive.jpg" alt="374 responsive">-->
											<!--<p>商品1</p>-->
										<!--</a>-->
									<!--</div>                  -->
									<!--<div class="item">-->
										<!--<a href="item_preview.html" class="thumbnail">-->
											<!--<img src="images/templatemo_373_nightlight.jpg" alt="373 nightlight">-->
											<!--<p>商品1</p>-->
										<!--</a>-->
									<!--</div>-->
                                    <!---->
									<!--<div class="item">-->
										<!--<a href="item_preview.html" class="thumbnail">-->
											<!--<img src="images/templatemo_372_titanium.jpg" alt="372 titanium">-->
											<!--<p >商品1</p>-->
										<!--</a>-->
									<!--</div>-->
									<!--<div class="item">-->
										<!--<a href="item_preview.html" class="thumbnail">-->
											<!--<img src="images/templatemo_369_music_gallery.jpg" alt="369 music gallery">-->
											<!--<p>商品1 </p>-->
										<!--</a>-->
									<!--</div>-->
									<!--<div class="item">-->
										<!--<a href="item_preview.html" class="thumbnail">-->
											<!--<img src="images/templatemo_367_shoes.jpg" alt="367 shoes">-->
											<!--<p>商品1</p>-->
										<!--</a>-->
									<!--</div>-->
									<!--<div class="item">-->
										<!--<a href="item_preview.html" class="thumbnail">-->
											<!--<img src="images/templatemo_365_orando.jpg" alt="365 orando">-->
											<!--<p>商品1</p>-->
										<!--</a>-->
									<!--</div>-->
                                    <!--<div class="item">-->
										<!--<a  href="#"  class="thumbnail">-->
											<!--<img src="images/templatemo_378_dragonfly.jpg" alt="378 dragonfly">-->
											<!--<p>Dragonfly</p>-->
										<!--</a>-->
									<!--</div>		          -->
									<!--<div class="item">-->
										<!--<a  href="#"  class="thumbnail">-->
											<!--<img src="images/templatemo_375_tech_layer.jpg" alt="375 tech layer">-->
											<!--<p>Tech Layer</p>-->
										<!--</a>-->
									<!--</div>-->
									<!--<div class="item">-->
										<!--<a  href="#"  class="thumbnail">-->
											<!--<img src="images/templatemo_371_gallery.jpg" alt="371 gallery">-->
											<!--<p>Gallery</p>-->
										<!--</a>-->
									<!--</div>                  -->
									<!--<div class="item">-->
										<!--<a  href="#"  class="thumbnail">-->
											<!--<img src="images/templatemo_370_focus.jpg" alt="370 focus">-->
											<!--<p>Focus</p>-->
										<!--</a>-->
									<!--</div>-->
								</div>
								<div id="pageBar" style="text-align: center; position: absolute; left: 0px; top: 627px;width:600px">
									<!-- 分页 -->
								</div>
							</div>
						</div>
		
					</section> <!-- flash gallery -->		
				</div> <!-- col -->
			</div>  <!-- row -->   
		</div> <!-- container -->
		<footer class="container">
			<div class="credit">
				<p id="templatemo_cr_bar">
					Copyright © 2072 <a href="#">xxxxxxx</a> | <a href="#"  title="xxxxx">xxxx</a> Collect from <a href="#">xxxxxxx</a>
				</p>
			</div>
		</footer>

		<!-- Bootstrap core JavaScript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/offcanvas.js"></script>
	    <!-- 
		http://masonry.desandro.com/
	    http://desandro.mit-license.org/ 
		http://stackoverflow.com/questions/17767130/masonry-js-error-uncaught-typeerror-object-object-object-has-no-method-imag
		Align items in center: https://github.com/desandro/isotope/issues/20
	    Hiding text overflow: http://stackoverflow.com/questions/15308061/how-to-avoid-text-overflow-in-twitter-bootstrap
		-->
		<script src="js/masonry.pkgd.min.js"></script>
		<script src="js/imagesloaded.pkgd.min.js"></script>
		<script src="../../js/common.js"></script>

		<script type="text/javascript">

			$(document).ready(function(){
				init_masonry();
			});

			function init_masonry(){
				var $container = $('.item_container');
				$container.imagesLoaded( function(){
					$container.masonry({
						itemSelector : '.item',
						"gutter": 18,
						isFitWidth: true
					});
				});
			}

			var pageNo = 1;
			var pageSize = 12;
			var name = null;
			var categoryId = null;

			$(function() {
				init();
				initSearchButton();
				initCategory();
				initGoods();
			});

			/**
			 * 初始化
			 */
			function init(){
				$('a[href*=#]:not([href=#])').click(function() {
					if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
						var target = $(this.hash);
						target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
						if (target.length) {
							$('html,body').animate({
								scrollTop: target.offset().top
							}, 1000);
							return false;
						}
					}
				});
			}


			/**
			 * 初始化分类
			 */
			function initCategory(){
				var url = projectUrl + "/terminal/category/getAll.action";
				var data ={}
				$.get(url,data,function(databack){

					var code = databack.code;
					if(code == 5000){
						alert(databack.message);
					}else if(code == 2000){
						var categories = databack.data.list;
						var $categoryUl = $("#categoryUl");
						$categoryUl.empty();
						for(var i = 0; i < categories.length; i++){
							//创建li标签
							var $li = $("<li></li>");
							//创建a标签并添加到li标签
							$li.append(createCategroytagA(categories[i].id,categories[i].name));
							//将li标签添加到ul标签
							$categoryUl.append($li);
						}
					}
				});
			}

			/**
			 * 初始化商品列表和分页栏
			 */
			function initGoods(){
				pageNo = 1;
				pageSize = 12;
				name = null;
				categoryId = null;
				getInfo(pageNo);
			}

			/**
			 * 按照关键字，分类 获取当前页的所有商品信息
			 * param key:页数
			 */
			function getInfo(key){
				pageNo = key;
				var url = projectUrl + "/terminal/goods/findInPageByKey.action";

				var data = {"pageNo":pageNo,"pageSize":pageSize};
				if(categoryId != null && categoryId != "null" && categoryId.length != 0){
					data = {"pageNo":pageNo,"pageSize":pageSize,"categoryId":categoryId};
				}
				if(name != null && name != "null" && name.length != 0){
					data = {"pageNo":pageNo,"pageSize":pageSize,"name":name};
				}
				$.post(url,data,function(databack){
					var code = databack.code;
					if(code == 5000){
						alert(databack.message);
					}else if(code == 2000){
						var goods = databack.data.page.data;  //获取所有商品，这里是一个json数组
						//清空商品容器
						$("#item_container").empty();
						//清空分页栏
						$("#pageBar").empty();
						initPage(goods);
						intiPageBar(databack);
					}
				},"json");

			}


			/**
			 * 初始化当前页数的商品信息
			 */
			function initPage(goods){
				//获取商品容器
				var $container = $("#item_container");
				var style = [
						"position: absolute; left: 0px; top: 0px;",
						"position: absolute; left: 178px; top: 0px;",
						"position: absolute; left: 356px; top: 0px;",
						"position: absolute; left: 534px; top: 0px;",
						"position: absolute; left: 0px; top: 209px;",
						"position: absolute; left: 178px; top: 209px;",
						"position: absolute; left: 356px; top: 209px;",
						"position: absolute; left: 534px; top: 209px;",
						"position: absolute; left: 0px; top: 418px;",
						"position: absolute; left: 178px; top: 418px;",
						"position: absolute; left: 356px; top: 418px;",
						"position: absolute; left: 534px; top: 418px;",
				];
				for(var i = 0; i < goods.length; i++){
					var $div = $("<div class='item' style='"+ style[i] +"'></div>");
					var $a = createGoodstagA(goods[i]);
					$div.append($a);
					$container.append($div);
				}
			}

			/**
			 *  解析图片地址数组,并返回第一张图片地址
			 */
			function analImgArry(imgs){
				imgs = imgs.substring(1,imgs.length-1);
				var imgArr = imgs.split(",");
				return imgArr[0];
			}


			/**
			 * 初始化分页工具栏
			 */
			function intiPageBar(databack){
				/**初始化分页条**/
				var pNo = databack.data.page.pageNo; //当前页数

				var $pageDiv = $("<div></div>");
				var $nowPage = $("<span>"+ "当前第" + pNo + "页&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" +"</span>");
				$pageDiv.append($nowPage);
				var pageCount = databack.data.page.pageCount; //一用有多少页
				var barSize = 5;                         //工具条中分页的数目
				//判断总页数是否小于等于工具条中分页的数目
				if(pageCount <= barSize){
					for(var y = 1; y <= pageCount; y++){
						var $a3 = createAPageNode(y,y);
						$pageDiv.append($a3);
					}
				}else{//如果大于

					//判断是否第一页,是否最后一页
					if(pNo == 1){ //第一页
						for(var j = pNo; j < barSize + pNo; j++){
							var $a4 = createAPageNode(j,j)
							$pageDiv.append($a4);
						}
						//添加 下一页按钮
						var $anext = createAPageNode(pNo + 1,"下一页");
						$pageDiv.append($anext);
					}else if(pNo == pageCount){//最后一页
						//添加上一页按钮
						var $apre = createAPageNode(pNo-1,"上一页");
						$pageDiv.append($apre);
						for(var z = pageCount-barSize+1; z <= pageCount; z++){
							var $a5 = createAPageNode(z,z);
							$pageDiv.append($a5);
						}
					}else{
						//添加上一页按钮
						var $apre1 = createAPageNode(pNo-1,"上一页");
						$pageDiv.append($apre1);

						for(var w = pNo; w < barSize+pNo; w++){
							var $a6 = createAPageNode(w,w);
							$pageDiv.append($a6);
						}

						//添加 下一页按钮
						var $anext1 = createAPageNode(pNo + 1,"下一页");
						$pageDiv.append($anext1);
					}
				}
				$("#pageBar").append($pageDiv);
			}


			/**
			 * 创建一个分页a标签
			 */
			function createAPageNode(key,value) {
				return $("<a href='javascript:void(0)' onclick='getInfo("+ key + ")'>" + value + "&nbsp;&nbsp;</a>");
			}

			/**
			 * 创建分类的a标签
			 */
			function createCategroytagA(id,name){
				return $a = ("<a href='javascript:void(0)' onclick=\"findByCategoryId('" + id + "')\" > " + name + "</a>");
			}

			/**
			 * 创建商品a标签(id,name)
			 */
			function createGoodstagA(good){
				$a = ("<a href='javascript:void(0)' class='thumbnail' onclick=\"goodsDetialUI('" + good.id + "')\" >" +
				"<img src="+ projectUrl + "/terminal/img/getImg.action?address=" + analImgArry(good.pictures) +" />" +
				"<p>" + good.name + "</p>" +
				"</a>");
				return $a
			}

			/**
			 *跳转到商品详情页面
			 */
			function goodsDetialUI(uid){
				var url = "item_preview.html?id=" + uid;
				window.location.href = url;
			}

			/**
			 * 根据类别id查询
			 * @param id
			 */
			function findByCategoryId(id){
				name = null;
				categoryId = id;
				pageNo = 1;
				getInfo(pageNo);
			}

			/**
			 * 根据商品名字模糊查询
			 * @param name
			 */
			function findLikeName(n){
				categoryId = null;
				name = n;
				pageNo = 1;
				getInfo(pageNo);
			}

			/**
			 * 初始化查找按钮的功能
			 */
			function initSearchButton(){
				$("#search").click(function(){
					var n = $("#searchKey").val();
					//alert(n);
					if(n == null || n.length == 0 || n == ""){
						n = null;
					}
					findLikeName(n);
				});
			}
		</script>
	</body>
</html>